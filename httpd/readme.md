
# Apache Httpd

## External directories

installation and config samples: [udemy.com: nginx-apache-ssl-encryption-certification-course](../_webserver/_udemy.com_nginx-apache-ssl-encryption-certification-course)  

installation (on Ubuntu): [udemy.com: setup-a-virtual-web-server-using-linode-or-digital-ocean](../_webserver/_udemy.com_setup-a-virtual-web-server-using-linode-or-digital-ocean)  


# Cheatsheet

- Website folders:
  - `/var/www/html/` - default folder
  - `/var/www/my_test_site.com/html/`
- Config files
  - `/etc/apache2/sites-available/my_test_site.com.conf`
- Log file paths:
  - `/var/log/httpd/*.log`
  - `/var/log/apache/*.log`
  - `/var/log/apache2/*.log`
- Log file names:
  - `access.log`
  - `error.log`

## Commands

```
apachectl configtest

# list enabled apache modules
apache2ctl -M
apachectl -t -D DUMP_MODULES
httpd -M    # RHEL, CentOS, Fedora
```

```
a2enmod
a2dismod

a2ensite
a2dissite

a2enconf
a2disconf
```

```
systemctl restart apache2
service apache2 restart
```

```
apachectl -k graceful
```

```
/etc/init.d/apache2
apache2ctl
/usr/bin/apache2  # directly will not work with the default configuration
```

## Sample Apache config file

- with redirection from HTTP to HTTPS
- with certificates generated by **letsencrypt's certbot**

`my_test_site.com.conf`:
```
<VirtualHost *:80>
        ServerAdmin admin@my_test_site.com
        ServerName my_test_site.com
        ServerAlias www.my_test_site.com
        DocumentRoot /var/www/my_test_site.com/html
        ErrorLog ${APACHE_LOG_DIR}/error.my_test_site.com.log
        CustomLog ${APACHE_LOG_DIR}/access.my_test_site.com.log combined
RewriteEngine on
RewriteCond %{SERVER_NAME} =my_test_site.com [OR]
RewriteCond %{SERVER_NAME} =www.my_test_site.com
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>
```

`my_test_site.com-le-ssl.conf`:
```
<IfModule mod_ssl.c>
<VirtualHost *:443>
        ServerAdmin admin@my_test_site.com
        ServerName my_test_site.com
        ServerAlias www.my_test_site.com
        DocumentRoot /var/www/my_test_site.com/html
        ErrorLog ${APACHE_LOG_DIR}/error.my_test_site.com.log
        CustomLog ${APACHE_LOG_DIR}/access.my_test_site.com.log combined
Include /etc/letsencrypt/options-ssl-apache.conf
SSLCertificateFile /etc/letsencrypt/live/my_test_site.com/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/my_test_site.com/privkey.pem
</VirtualHost>
</IfModule>
```
